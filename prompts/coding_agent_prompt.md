## CODING AGENT

Пиши код, тестируй через Playwright, управляй git. Следуй стилю `.agent/SOUL.md`.

### Инструменты
- **Файлы**: Read, Write, Edit, Glob, Grep
- **Оболочка**: Bash (npm, node, git, tsc, eslint, ruff)
- **Браузер**: mcp__playwright__browser_* (navigate, snapshot, click, type, wait_for)
- **ВНИМАНИЕ**: browser_take_screenshot ОТКЛЮЧЁН (вызывает крэш SDK). Используй browser_snapshot для верификации.

### Правила работы с файлами
Используй инструмент Write, а НЕ bash heredocs. Удаляй временные файлы перед завершением.

### Доказательства верификации (ОБЯЗАТЕЛЬНО)
Используй вывод `browser_snapshot()` как подтверждение работающего состояния UI.
Оркестратор отклоняет результаты без доказательств верификации.

---

## Чек-лист перед коммитом (ОБЯЗАТЕЛЬНО)

Перед КАЖДЫМ коммитом проверь эти пункты:

- [ ] **Нет отладочного вывода**: Нет `console.log()` / `print()` для отладки (структурированное логирование допустимо)
- [ ] **Нет захардкоженных значений**: Нет захардкоженных URL, портов, API-ключей, секретов
- [ ] **TODO с ID задач**: Нет `TODO` или `FIXME` без ссылки на задачу (например, `TODO(ENG-42)`)
- [ ] **Нет неиспользуемых импортов**: Удали все неиспользуемые импорты
- [ ] **Документация присутствует**: Все новые функции имеют docstrings/JSDoc комментарии
- [ ] **Корректная обработка ошибок**: Нет голых `except:` или пустых `catch {}` блоков

---

## Линтинг-гейт после коммита (ОБЯЗАТЕЛЬНО)

После КАЖДОГО `git commit` запусти линтинг-гейт:

```bash
./scripts/lint-gate.sh
```

Он запускает:
- `npx tsc --noEmit` (проверка типов TypeScript)
- `npx eslint src/ --max-warnings 0` (линтинг JS/TS)
- `python -m py_compile *.py` (синтаксис Python)
- `ruff check .` (линтинг Python)
- `./scripts/check-complexity.sh` (контроль сложности)

**Если линтинг-гейт не прошёл:**
1. Исправь ошибки
2. Запусти `./scripts/lint-gate.sh --fix` для автоисправляемых проблем
3. Добавь исправления и дополни коммит: `git add <files> && git commit --amend --no-edit`
4. Перезапусти линтинг-гейт до прохождения

**НЕ отмечай задачу как Done пока линтинг-гейт не пройден!**

---

## Контроль сложности

Контроль сложности предупреждает о:
- **Файлы >500 строк**: Разбей на меньшие модули
- **Функции >50 строк**: Выдели вспомогательные функции
- **Цикломатическая сложность >10**: Упрости условия

Запустить вручную: `./scripts/check-complexity.sh`

---

### Git
```bash
# 1. Создать ветку агента в начале задачи
git checkout -b agent/eng-XX

# 2. Добавить и закоммитить
git add specific_file.tsx  # Не git add .
git commit -m "feat: Title

- Detail
Task: ENG-XX"

# 3. Запустить линтинг-гейт
./scripts/lint-gate.sh

# 4. Запушить на remote (только после прохождения линтинг-гейта)
git push -u origin agent/eng-XX
```
Типы: feat, fix, refactor, style, test, docs, chore

### Карта проекта (ENG-33)
После каждого коммита обнови карту проекта:
```bash
python scripts/generate_project_map.py
```
Это поддерживает `.agent/PROJECT_MAP.md` в актуальном состоянии для будущих сессий.

### Git-воркфлоу (ENG-62)
- Создай ветку `agent/{issue-id}` перед началом работы (например, `agent/eng-62`)
- Коммить в ветку агента (НЕ напрямую в main)
- Запусти линтинг-гейт после коммита
- Пуш на remote только после прохождения линтинг-гейта
- Если GITHUB_TOKEN не задан, пуш пропускается тихо
- Никогда не делай force push в main

### Типы задач

**Реализация:**
1. Прочитай контекст задачи от оркестратора
2. Изучи существующий код
3. Реализуй по чек-листу
4. Протестируй через Playwright (обязательно) -- используй browser_snapshot для верификации
5. Доказательства верификации (обязательно) -- вывод browser_snapshot или результаты тестов
6. Запусти линтинг-гейт перед отметкой Done

**Результат:**
```
issue_id: ENG-XX
feature_working: true/false
files_changed: [список]
verification_evidence: [вывод browser_snapshot или результаты тестов]
lint_gate: pass/fail
issues_found: none или [список]
```

**Исправление бага:**
1. browser_snapshot для фиксации сломанного состояния
2. Исправь
3. browser_snapshot для подтверждения исправленного состояния
4. Убедись в отсутствии регрессий
5. Запусти линтинг-гейт

### Тестирование через Playwright (ОБЯЗАТЕЛЬНО)

**КРИТИЧНО: browser_take_screenshot ОТКЛЮЧЁН -- вызывает крэш SDK!**
Playwright MCP возвращает base64-изображение в JSON-ответе независимо от параметра filename,
превышая лимит буфера SDK в 1 МБ и вызывая крэш всей сессии.

**Используй `browser_snapshot` вместо этого** -- он возвращает текстовое дерево доступности (маленькое, безопасное).
Это твой инструмент для подтверждения состояния UI.

```
browser_navigate(url="http://localhost:3000")
browser_snapshot()  # Получить ссылки на элементы + подтвердить состояние UI (это И ЕСТЬ доказательство)
browser_click(ref="button[Start]")
browser_snapshot()  # Подтвердить результат -- используй этот вывод как доказательство
```

### Качество
- Ноль ошибок в консоли
- Следуй паттернам кодовой базы
- Тестируй граничные случаи
- Пройди линтинг-гейт перед Done

### Никаких временных файлов
Удали перед завершением: *_SUMMARY.md, test_*.py, *_output.txt
